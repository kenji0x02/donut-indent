/*!
 * donut-indent
 * Copyright (c) 2015, kenji0x02. (MIT Licensed)
 * https://github.com/kenji0x02/donut-indent
 */
!function(n){"use strict";function e(e){return n(e+":header").css("fontSize").replace("px","")-0}function t(e){return n(e+":header").css("line-height").replace("px","")-0}function r(n){return Math.round(.45*n)}function a(n,e){return Math.round(.05*e+.5*(n-e))}function u(n){return Math.round(.45*n)}function i(e,t,r){n(r).css("margin-top",t),n(r).css("margin-right",t),r.width=e,r.height=e}function o(n,e,t,r,a){var u=a.getContext("2d"),i=1.5707963267948966,o=-i,f=i*(.04*t-1);u.beginPath(),u.moveTo(e,e),u.arc(e,e,n,o,f,!1),u.fillStyle=r,u.fill()}function f(n){var f=n.replace("donut_indent_","").split("_").map(function(n){return n-0}),c="h"+f.filter(function(n,e,t){return 0!=n}).length,d=e(c),h=t(c),s=r(d),l=a(h,d),m=u(d),v=document.getElementById(n);i(2*s,l,v),f.forEach(function(n,e,t){var r=Math.round(s*g.radiusRatio[e]);o(r-1,m,100,"#fff",v);var a="#59bb0c";1==e?a="#40A200":2==e&&(a="#268800"),o(r,m,n,a,v)})}function c(e){var t={};g.headerTagNumbers.forEach(function(n){t[n]=0});var r=[];return n.each(e,function(e,a){var u=n.extend(!0,{},t);e>0&&(u=n.extend(!0,{},r[e-1]));var i=a.tagName.replace("H","")-0;u.headerNumber=i,u[i]+=1,g.headerTagNumbers.forEach(function(n){n>i&&(u[n]=0)}),r.push(u)}),r}function d(n){for(var e=1;e<n.length;e++){if(n[e].headerNumber<n[e-1].headerNumber){var t=g.headerTagNumbers.filter(function(t){return t>n[e].headerNumber});t.forEach(function(t,r,a){for(var u=n[e-1][t],i=e-1;i>0&&0!=n[i][t];i--)n[i][t]=Math.round(n[i][t]/u*100)})}e==n.length-1&&g.headerTagNumbers.forEach(function(t,r,a){for(var u=n[e][t],i=e;i>=0&&0!=n[i][t];i--)n[i][t]=Math.round(n[i][t]/u*100)})}return n}function h(n){var e=d(c(n));return e.map(function(n,e,t){return m+g.headerTagNumbers.map(function(e){return n[e]}).join("_")})}function s(e,t){n.each(e,function(e,r){n(r).wrap("<div></div>");var a='<div style="float:left;"><canvas id="'+t[e]+'"></div>';n(r).before(a)})}function l(){var e=n(":header"),t=h(e);s(e,t),t.forEach(function(n){f(n)})}var m="donut_indent_",g={};g={defaults:{indentDepth:3,color:"#59bb0c",gammmaValue:1.8},settings:n.extend(!0,{},g.defaults),init:function(e){g.settings=n.extend(g.defaults,e),g.headerTagNumbers=Array.apply(null,Array(g.settings.indentDepth)).map(function(n,e){return e+1}),g.radiusRatio=n.extend(!0,[],g.headerTagNumbers).reverse().map(function(n){return Math.pow(1*n/g.headerTagNumbers.length,1/g.settings.gammmaValue)})}},n.donutIndent=function(n){g.init(n),l()}}(jQuery),$.donutIndent();
